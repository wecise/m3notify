(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-381f5ebe"],{"0145":function(e,t,a){"use strict";a.r(t);var _=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",[a("el-header",[a("el-tooltip",{attrs:{content:"刷新模板"}},[a("el-button",{attrs:{type:"text",icon:"el-icon-refresh"},on:{click:e.onRefresh}})],1),a("el-tooltip",{attrs:{content:"新建模板"}},[a("el-button",{attrs:{type:"text",icon:"el-icon-plus"},on:{click:e.onNew}})],1),a("div",{staticStyle:{position:"absolute",right:"20px",top:"14px"}},[a("el-input",{attrs:{clearable:"",placeholder:"关键字"},model:{value:e.dt.search,callback:function(t){e.$set(e.dt,"search",t)},expression:"dt.search"}})],1)],1),a("el-main",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.dt.rows,"row-class-name":e.rowClassName,height:"calc(100vh - 200px)"}},[e._l(e.dt.columns,(function(t,_){return[t.visible?a("el-table-column",{key:_,attrs:{prop:t.field,label:t.title,sortable:"","show-overflow-tooltip":"",width:t.width,formatter:t.render},scopedSlots:e._u([{key:"default",fn:function(_){return["tags"==t.field?a("div",{staticStyle:{height:"30px","line-height":"30px"}},[a("TagView",{attrs:{domain:"notifyTemplate",model:_.row.tags,id:_.row.id,limit:1},on:{"update:model":function(t){return e.$set(_.row,"tags",t)}}})],1):"function"===typeof t.render?a("div",{domProps:{innerHTML:e._s(t.render(_.row,_.column,_.row[t.field],_.$index))}}):a("div",[e._v(" "+e._s(_.row[t.field])+" ")])]}}],null,!0)}):e._e()]})),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.onEdit(t.$index,t.row)}}},[e._v(" 编辑")]),a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.onDelete(t.$index,t.row)}}},[e._v(" 删除")]),a("el-switch",{staticStyle:{"padding-left":"10px"},attrs:{"active-color":"#13ce66","inactive-color":"#ff4949","active-value":1,"inactive-value":0},on:{change:function(a){return e.onToggleStatus(t.row)}},model:{value:t.row["status"],callback:function(a){e.$set(t.row,"status",a)},expression:"scope.row['status']"}})]}}])})],2),e.dialog.template.show?a("el-dialog",{attrs:{title:"模版管理",visible:e.dialog.template.show,"append-to-body":!0,"show-close":!1,"close-on-press-escape":!1,"close-on-click-modal":!1,"destroy-on-close":!0},on:{"update:visible":function(t){return e.$set(e.dialog.template,"show",t)}}},[a("el-form",{ref:"templateForm",attrs:{model:e.dialog.template.data,rules:e.dialog.template.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"名称",prop:"name"}},[a("el-input",{attrs:{disabled:"update"===e.dialog.template.action},model:{value:e.dialog.template.data.name,callback:function(t){e.$set(e.dialog.template.data,"name",t)},expression:"dialog.template.data.name"}})],1),a("el-form-item",{attrs:{label:"数据源"}},[a("el-input",{attrs:{disabled:""},model:{value:e.dialog.template.datasource.class,callback:function(t){e.$set(e.dialog.template.datasource,"class",t)},expression:"dialog.template.datasource.class"}},[a("el-dropdown",{attrs:{slot:"prepend"},slot:"prepend"},[a("span",{staticClass:"el-dropdown-link"},[a("i",{staticClass:"el-icon-coin el-icon--right",staticStyle:{cursor:"pointer"}})]),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("DatasourceView",{attrs:{root:e.dialog.template.datasource.root},on:{"node-click":e.onDataSourceSelect}})],1)],1)],1)],1),e.dialog.template.datasource.data?a("el-form-item",{attrs:{label:"属性"}},[a("DataFieldsView",{attrs:{fields:e.dialog.template.datasource.data.fields},on:{"fields-change":e.onDataFieldsSelect,"node-click":e.onDataFieldsSelect}})],1):e._e(),a("el-form-item",{attrs:{label:"模版定义",prop:"content"}},[a("VueEditor",{ref:"editorRef",staticStyle:{border:"1px solid #f2f2f2"},attrs:{lang:e.editor.lang.value,theme:e.editor.theme.value,width:"inherit",height:"calc(100vh - 425px)"},on:{init:e.onEditorInit},model:{value:e.dialog.template.data.content,callback:function(t){e.$set(e.dialog.template.data,"content",t)},expression:"dialog.template.data.content"}})],1),a("el-form-item",{attrs:{label:"状态",prop:"status"}},[a("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#dddddd","active-value":1,"inactive-value":0},model:{value:e.dialog.template.data.attr.status,callback:function(t){e.$set(e.dialog.template.data.attr,"status",t)},expression:"dialog.template.data.attr.status"}},[e._v("> ")])],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialog.template.show=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.onSave}},[e._v("确 定")])],1)],1):e._e()],1)],1)},s=[],o=a("3caf"),i=o["a"],l=(a("73a2"),a("2877")),n=Object(l["a"])(i,_,s,!1,null,"116d7fa1",null);t["default"]=n.exports},"1ebc":function(e,t,a){},"3caf":function(module,__webpack_exports__,__webpack_require__){"use strict";var core_js_modules_es_array_filter_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("4de4"),core_js_modules_es_array_filter_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es_array_filter_js__WEBPACK_IMPORTED_MODULE_0__),core_js_modules_es_array_includes_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("caad"),core_js_modules_es_array_includes_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es_array_includes_js__WEBPACK_IMPORTED_MODULE_1__),core_js_modules_es_string_includes_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("2532"),core_js_modules_es_string_includes_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(core_js_modules_es_string_includes_js__WEBPACK_IMPORTED_MODULE_2__),core_js_modules_es_function_name_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("b0c0"),core_js_modules_es_function_name_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_es_function_name_js__WEBPACK_IMPORTED_MODULE_3__),core_js_modules_es_array_map_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("d81d"),core_js_modules_es_array_map_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(core_js_modules_es_array_map_js__WEBPACK_IMPORTED_MODULE_4__),core_js_modules_es_string_replace_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("5319"),core_js_modules_es_string_replace_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(core_js_modules_es_string_replace_js__WEBPACK_IMPORTED_MODULE_5__),core_js_modules_es_regexp_exec_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("ac1f"),core_js_modules_es_regexp_exec_js__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(core_js_modules_es_regexp_exec_js__WEBPACK_IMPORTED_MODULE_6__),core_js_modules_es_array_join_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("a15b"),core_js_modules_es_array_join_js__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(core_js_modules_es_array_join_js__WEBPACK_IMPORTED_MODULE_7__),lodash__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("2ef0"),lodash__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_8__),_tags_TagView__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("4aea"),_DatasourceView__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("8097"),_DataFieldsView__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("fe86");__webpack_exports__["a"]={name:"TemplateView",props:{model:Object},components:{TagView:_tags_TagView__WEBPACK_IMPORTED_MODULE_9__["a"],VueEditor:__webpack_require__("7c9e"),DatasourceView:_DatasourceView__WEBPACK_IMPORTED_MODULE_10__["a"],DataFieldsView:_DataFieldsView__WEBPACK_IMPORTED_MODULE_11__["a"]},data:function(){return{dt:{rows:[],columns:[],selected:[],radio:"",search:""},dialog:{template:{show:!1,datasource:{root:"/matrix/devops",fields:[],class:"",data:null},data:{name:"",ftype:"json",attr:{remark:"",status:0},parent:"/home/".concat(window.auth.signedUser.username,"/Documents/notify"),content:""},rules:{name:[{required:!0,message:"请输入名称",trigger:"blur"}]},action:""}},editor:{value:"",loading:!1,lang:{value:"javascript",list:[]},theme:{value:"merbivore",list:this.m3.EDITOR_THEME}}}},watch:{"dt.search":{handler:function(e){lodash__WEBPACK_IMPORTED_MODULE_8___default.a.isEmpty(e)?this.initData():this.dt.rows=this.dt.rows.filter((function(t){return!e||t.name.toLowerCase().includes(e.toLowerCase())}))}}},created:function(){this.initData()},methods:{initEditor:function(){var e=this.$refs.editorRef.editor;e.on("mousemove",(function(){e.resize()}))},onEditorInit:function(){__webpack_require__("2099"),__webpack_require__("c1d1")("./".concat(this.editor.lang.value)),__webpack_require__("baa7")("./".concat(this.editor.lang.value)),__webpack_require__("07ed")("./".concat(this.editor.theme.value)),this.initEditor()},rowClassName:function(e){var t=e.rowIndex;return"row-".concat(t)},onDataSourceSelect:function(e){this.dialog.template.datasource.class=e.class,this.dialog.template.datasource.data=e;var t=JSON.parse(this.dialog.template.data.content);t.class=e.class,this.dialog.template.data.content=JSON.stringify(t,null,2)},onDataFieldsSelect:function(e){this.dialog.template.datasource.fields=e;var t=JSON.parse(this.dialog.template.data.content);t.fields=e,this.dialog.template.data.content=JSON.stringify(t,null,2)},initData:function initData(){var _this=this;this.m3.callFS("/matrix/m3event/notify/getTemplateList.js",null).then((function(rt){var rtn=rt.message;_this.$set(_this.dt,"rows",rtn.rows),_this.$set(_this.dt,"columns",lodash__WEBPACK_IMPORTED_MODULE_8___default.a.map(rtn.columns,(function(v){return lodash__WEBPACK_IMPORTED_MODULE_8___default.a.isUndefined(v.visible)&&lodash__WEBPACK_IMPORTED_MODULE_8___default.a.extend(v,{visible:!0}),v.render?lodash__WEBPACK_IMPORTED_MODULE_8___default.a.extend(v,{render:eval(v.render)}):v})))}))},onRefresh:function(){this.initData()},onReset:function(){this.$refs["templateForm"]&&this.$refs["templateForm"].resetFields()},onNew:function(){this.onReset(),this.dialog.template.show=!0,this.dialog.template.action="add"},onSave:function(){var e=this;if(lodash__WEBPACK_IMPORTED_MODULE_8___default.a.isEmpty(this.dialog.template.data.name))return this.$message.warning("请输入名称"),!1;var t={parent:this.dialog.template.data.parent,name:[this.dialog.template.data.name,this.dialog.template.data.ftype].join(".").replace(/.json.json/,".json"),data:{content:this.dialog.template.data.content,ftype:this.dialog.template.data.ftype,attr:this.dialog.template.data.attr,index:!0}};this.m3.dfsNew(t).then((function(){e.$message({type:"success",message:"新建模板成功！"}),e.initData(),e.dialog.template.show=!1})).catch((function(t){e.$message({type:"error",message:"新建模板失败 "+t.message})}))},onToggleStatus:function(e){var t=this;console.log(e),this.dialog.template.action="update";var a=lodash__WEBPACK_IMPORTED_MODULE_8___default.a.extend(e.attr,{status:e.status}),_={parent:e.parent,name:[e.name,e.ftype].join(".").replace(/.json.json/,".json"),data:{content:e.content,ftype:e.ftype,attr:a,index:!0}};this.m3.dfsNew(_).then((function(){t.$message({type:"success",message:e.status?"模板已启用":"模板已禁用"})}))},onDelete:function(e,t){var a=this;console.log(e),this.$confirm("确认要删除该模板：".concat(t.name,"？"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var e={parent:t.parent,name:t.name};a.m3.dfsDelete(e).then((function(){a.$message({type:"success",message:"删除模板成功!"}),a.initData()})).catch((function(e){a.$message({type:"error",message:"删除模板失败 "+e.message})}))}))},onEdit:function(e,t){this.dialog.template.show=!0,this.dialog.template.data=t,this.dialog.template.action="update"}}}},"73a2":function(e,t,a){"use strict";a("1ebc")},fe86:function(e,t,a){"use strict";var _=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-cascader",{attrs:{options:e.options,props:e.props,"collapse-tags":"",clearable:""},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}})},s=[],o=(a("d81d"),a("2ef0")),i=a.n(o),l={name:"DataFieldsView",props:{fields:Array},data:function(){return{value:[],options:[],props:{multiple:!0,emitPath:!1,checkStrictly:!0}}},watch:{fields:{handler:function(e){this.options=i.a.map(e,(function(e){return{value:e,label:e,children:[]}}))},immediate:!0},value:{handler:function(e){this.$emit("fields-change",e)}}}},n=l,r=a("2877"),c=Object(r["a"])(n,_,s,!1,null,"cbb13ffa",null);t["a"]=c.exports}}]);